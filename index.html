<!DOCTYPE html>
<html lang="en">
<!-- Previous head content remains the same until the additional styles -->
<head>
    <!-- ... (previous head content) ... -->
    <style>
        /* ... (previous styles) ... */

        /* Date Range Selector Styles */
        .date-range-container {
            background-color: #3a3a4f;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .date-range-container input[type="date"] {
            width: calc(50% - 10px);
            padding: 8px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background-color: #f0f0f0;
        }

        .date-range-summary {
            background-color: #3a3a4f;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            color: #d0d0d0;
        }

        .date-range-summary h3 {
            text-align: center;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- ... (previous body content until main-content div) ... -->

    <!-- Inside main-content div, add this before the transaction log -->
    <div class="date-range-container">
        <h3>Date Range Summary</h3>
        <input type="date" id="startDate">
        <input type="date" id="endDate">
        <button onclick="calculateDateRange()">Calculate Range</button>
        
        <div class="date-range-summary">
            <h3>Range Summary</h3>
            <div class="summary-item">
                Gross: $<span id="rangeGross">0.00</span><br>
                Tips: $<span id="rangeTips">0.00</span><br>
                Net: $<span id="rangeNet">0.00</span><br>
                Transactions: <span id="rangeCount">0</span>
            </div>
        </div>
    </div>

    <!-- ... (rest of the previous body content) ... -->

    <!-- Add this function to your existing JavaScript, before the closing script tag -->
    <script>
        // ... (previous JavaScript code) ...

        function calculateDateRange() {
            const startDate = new Date(document.getElementById("startDate").value);
            const endDate = new Date(document.getElementById("endDate").value);
            
            // Set endDate to end of day
            endDate.setHours(23, 59, 59, 999);

            // Clear invalid dates
            if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                alert("Please select valid start and end dates");
                return;
            }

            // Fetch all transactions and filter client-side
            db.collection("earnings")
                .where("userId", "==", auth.currentUser.uid)
                .get()
                .then((querySnapshot) => {
                    let rangeGross = 0;
                    let rangeTips = 0;
                    let rangeNet = 0;
                    let transactionCount = 0;

                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const transactionDate = data.timestamp?.toDate();
                        
                        if (transactionDate && 
                            transactionDate >= startDate && 
                            transactionDate <= endDate) {
                            rangeGross += data.gross;
                            rangeTips += data.tips;
                            rangeNet += data.net;
                            transactionCount++;
                        }
                    });

                    // Update the range summary display
                    document.getElementById("rangeGross").innerText = rangeGross.toFixed(2);
                    document.getElementById("rangeTips").innerText = rangeTips.toFixed(2);
                    document.getElementById("rangeNet").innerText = rangeNet.toFixed(2);
                    document.getElementById("rangeCount").innerText = transactionCount;
                })
                .catch((error) => console.error("Error calculating date range:", error));
        }

        // Initialize date inputs with reasonable defaults
        function initializeDateInputs() {
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);

            document.getElementById("startDate").valueAsDate = thirtyDaysAgo;
            document.getElementById("endDate").valueAsDate = today;
        }

        // Add this to your existing auth.onAuthStateChanged callback
        auth.onAuthStateChanged((user) => {
            if (user) {
                showMainContent();
                initializeDateInputs(); // Initialize date inputs when user logs in
            } else {
                showLogin();
            }
        });
    </script>
</body>
</html>
