<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDwkAyX5RSMXDSe7PHSd7ZwI27Ed5uEhKo",
        authDomain: "club-tattoo-earnings-tracker.firebaseapp.com",
        projectId: "club-tattoo-earnings-tracker",
        storageBucket: "club-tattoo-earnings-tracker.appspot.com",
        messagingSenderId: "411443089106",
        appId: "1:411443089106:web:93a23cea86e8d008d7a70b",
        measurementId: "G-6W7SQXCWJC"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Show or hide sections based on login state
    function showMainContent() {
        document.getElementById("login-container").style.display = "none";
        document.getElementById("main-content").style.display = "block";
    }

    function showLogin() {
        document.getElementById("login-container").style.display = "block";
        document.getElementById("main-content").style.display = "none";
    }

    // Check login state on page load
    auth.onAuthStateChanged((user) => {
        if (user) {
            showMainContent();
        } else {
            showLogin();
        }
    });

    // Sign Up function
    function signUp() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        auth.createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                alert("Sign-up successful!");
                showMainContent();
            })
            .catch((error) => {
                alert(error.message);
            });
    }

    // Log In function
    function logIn() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                alert("Log-in successful!");
                showMainContent();
            })
            .catch((error) => {
                alert(error.message);
            });
    }

    // Log Out function
    function logOut() {
        auth.signOut()
            .then(() => {
                alert("Logged out successfully!");
                showLogin();
            })
            .catch((error) => {
                alert(error.message);
            });
    }

    // Record Transaction function
    function recordTransaction() {
        const totalTattooValue = parseFloat(document.getElementById("totalTattooValue").value) || 0;
        const percentageEarned = (parseFloat(document.getElementById("percentageEarned").value) || 0) / 100;
        const cashTip = parseFloat(document.getElementById("cashTip").value) || 0;
        const cardTip = parseFloat(document.getElementById("cardTip").value) || 0;

        const earnings = (totalTattooValue * percentageEarned) + cashTip + cardTip;

        // Save transaction to Firestore
        db.collection("earnings").add({
            userId: auth.currentUser.uid,
            totalTattooValue,
            percentageEarned,
            cashTip,
            cardTip,
            earnings,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            alert("Transaction recorded!");
        }).catch((error) => {
            alert("Error recording transaction: " + error.message);
        });
    }

    // Calculate Net Profit function
    function calculateNetProfit() {
        db.collection("earnings")
            .where("userId", "==", auth.currentUser.uid)
            .get()
            .then((querySnapshot) => {
                let netProfit = 0;
                querySnapshot.forEach((doc) => {
                    netProfit += doc.data().earnings;
                });
                document.getElementById("netProfitDisplay").innerText = "Net Profit: $" + netProfit.toFixed(2);
            })
            .catch((error) => {
                alert("Error calculating net profit: " + error.message);
            });
    }
</script>
